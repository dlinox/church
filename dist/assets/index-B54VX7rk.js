import{j as U,k as P,d as $,b as m,r as n,o as g,c as D,w as t,a as e,u as x,g as k,f as G,v as j,x as z,F as A,p as J,q as K}from"./index-DEEauFT0.js";import{i as Q}from"./DataTable.types-CX4v7_jN.js";import{r as B}from"./ruleUtils-C0l0TtdP.js";const T="http://lnx.simple.auth.test/api/roles",W=async a=>{try{const o=U();return(await P(o,T).post("/load-data-table",a)).data.data}catch{return Q()}},X=async a=>{try{const o=U();return await P(o,T).post("/save",a),!0}catch{return!1}},Y=async a=>{try{const o=U();return await P(o,T).delete(`/delete/${a}`),!0}catch{return!1}},Z=async()=>{try{const a=U(),o=await P(a,T).get("/all-permissions");return console.log(o.data),o.data.data}catch{return[]}},ee=async a=>{try{const o=U();return await P(o,T).post("/assign-permissions/",a),!0}catch{return!1}},te=[{title:"Op.",key:"actions",value:"actions",fixed:!0,width:"50px",sortable:!1},{title:"Nombre",key:"displayName",value:"displayName"},{title:"Clave",key:"name",value:"name"}],ne={displayName:[B],permissions:[B]},oe=()=>({id:null,displayName:null,permissions:[]}),F=$({__name:"Form",props:{formState:{type:Object,default:()=>({})}},emits:["onSuccess"],setup(a,{emit:o}){const s=o,w=a,v=ne,_=m(null),d=m(!1),u=m(!1),l=m({...oe(),...w.formState}),b=async()=>{const{valid:y}=await _.value.validate();if(!y)return;d.value=!0,await X(l.value)&&(l.value.id==null&&_.value.reset(),s("onSuccess"),u.value=!1),d.value=!1};return(y,r)=>{const E=n("v-text-field"),i=n("v-col"),N=n("v-row"),R=n("v-card-item"),c=n("v-btn"),p=n("v-spacer"),V=n("v-card-actions"),O=n("v-card"),S=n("v-form"),I=n("v-dialog");return g(),D(I,{"max-width":"500",modelValue:u.value,"onUpdate:modelValue":r[2]||(r[2]=f=>u.value=f),activator:"parent"},{default:t(()=>[e(S,{ref_key:"formRef",ref:_,onSubmit:G(b,["prevent"])},{default:t(()=>[e(O,{title:l.value.id?"Editar Registro":"Nuevo Registro"},{default:t(()=>[e(R,{class:"border-t border-b"},{default:t(()=>[e(N,null,{default:t(()=>[e(i,{cols:"12"},{default:t(()=>[e(E,{modelValue:l.value.displayName,"onUpdate:modelValue":r[0]||(r[0]=f=>l.value.displayName=f),label:"Nombre",rules:x(v).displayName,autocomplete:"off"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),e(V,null,{default:t(()=>[e(c,{type:"button",variant:"text",color:"secondary",onClick:r[1]||(r[1]=f=>u.value=!1)},{default:t(()=>r[3]||(r[3]=[k(" Cancelar ")])),_:1}),e(p),e(c,{text:"Guardar",color:"primary",type:"submit",loading:d.value},null,8,["loading"])]),_:1})]),_:1},8,["title"])]),_:1},512)]),_:1},8,["modelValue"])}}}),ae=$({__name:"AssignPermissions",props:{roleId:{},permissions:{}},emits:["onSuccess"],setup(a,{emit:o}){const s=o,w=a,v=m({roleId:w.roleId,permissions:[]}),_=m(null),d=m(!1),u=m(!1),l=m([...w.permissions]),b=async()=>{u.value=!0,v.value.permissions=l.value,await ee(v.value),d.value=!1,u.value=!1,s("onSuccess")},y=m([]);return(async()=>{v.value.permissions=[],y.value=await Z()})(),(E,i)=>{const N=n("v-checkbox"),R=n("v-col"),c=n("v-row"),p=n("v-expansion-panel-text"),V=n("v-expansion-panel"),O=n("v-expansion-panels"),S=n("v-btn"),I=n("v-spacer"),f=n("v-card-actions"),h=n("v-card"),q=n("v-form"),M=n("v-dialog");return g(),D(M,{"max-width":"1000",modelValue:d.value,"onUpdate:modelValue":i[2]||(i[2]=C=>d.value=C),activator:"parent"},{default:t(()=>[e(q,{ref_key:"formRef",ref:_,onSubmit:G(b,["prevent"])},{default:t(()=>[e(h,{title:"Asignar permisos"},{default:t(()=>[e(O,null,{default:t(()=>[(g(!0),j(A,null,z(y.value,C=>(g(),D(V,{key:C.id,title:C.name},{default:t(()=>[e(p,null,{default:t(()=>[e(c,null,{default:t(()=>[(g(!0),j(A,null,z(C.children,L=>(g(),D(R,{cols:"12",sm:"6",md:"4",class:"ma-0 pa-1",key:L.id},{default:t(()=>[e(N,{modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=H=>l.value=H),label:L.name,value:L.id},null,8,["modelValue","label","value"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1}),e(f,null,{default:t(()=>[e(S,{type:"button",variant:"text",color:"secondary",onClick:i[1]||(i[1]=C=>d.value=!1)},{default:t(()=>i[3]||(i[3]=[k(" Cancelar ")])),_:1}),e(I),e(S,{text:"Guardar",color:"primary",type:"submit",loading:u.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue"])}}}),ie=$({__name:"index",setup(a){return(o,s)=>{const w=n("v-text-field"),v=n("v-col"),_=n("v-btn"),d=n("v-row"),u=n("v-card-item"),l=n("v-icon"),b=n("v-list-item"),y=n("LnxDialogConfirm"),r=n("v-list"),E=n("v-menu"),i=n("LnxDataTable"),N=n("v-card"),R=J("tooltip");return g(),D(N,{title:"Roles",subtitle:"Gestión de roles"},{default:t(()=>[e(i,{loadDataTable:x(W),headers:x(te)},{header:t(({request:c,loading:p,init:V,loadingTable:O,debouncedReload:S,reLoadDataTable:I})=>[e(u,{class:"border-t border-b"},{default:t(()=>[e(d,{class:"d-flex justify-space-between align-center"},{default:t(()=>[e(v,{cols:"12",md:"4"},{default:t(()=>[e(w,{modelValue:c.search,"onUpdate:modelValue":f=>c.search=f,label:"Buscar",clearable:"",onInput:S,"onClick:clear":I},null,8,["modelValue","onUpdate:modelValue","onInput","onClick:clear"])]),_:2},1024),e(v,{cols:"12",md:"4",class:"d-md-flex d-block justify-end text-end"},{default:t(()=>[e(_,{class:"me-2",disabled:p},{default:t(()=>[s[0]||(s[0]=k(" nuevo ")),e(x(F),{onOnSuccess:V},null,8,["onOnSuccess"])]),_:2},1032,["disabled"]),K(e(_,{density:"comfortable",icon:"mdi-reload",onClick:V,loading:O},null,8,["onClick","loading"]),[[R,"Recargar registros"]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.actions":t(({item:c,loadDataTable:p})=>[e(_,{icon:"",size:"small",variant:"text"},{default:t(()=>[e(l,null,{default:t(()=>s[1]||(s[1]=[k(" mdi-dots-vertical ")])),_:1}),e(E,{activator:"parent"},{default:t(()=>[e(r,{nav:""},{default:t(()=>[e(b,{title:"Asignar Permisos",density:"compact",value:"assign"},{prepend:t(()=>[e(l,{size:"small"},{default:t(()=>s[2]||(s[2]=[k(" mdi-shield-account ")])),_:1})]),default:t(()=>[e(x(ae),{roleId:c.id,permissions:c.permissions,onOnSuccess:p},null,8,["roleId","permissions","onOnSuccess"])]),_:2},1024),e(b,{title:"Editar",density:"compact",value:"edit"},{prepend:t(()=>[e(l,{size:"small"},{default:t(()=>s[3]||(s[3]=[k(" mdi-pencil ")])),_:1})]),default:t(()=>[e(x(F),{formState:c,onOnSuccess:p},null,8,["formState","onOnSuccess"])]),_:2},1024),e(b,{title:"Eliminar",class:"text-red",density:"compact",value:"delete"},{prepend:t(()=>[e(l,{size:"small"},{default:t(()=>s[4]||(s[4]=[k(" mdi-delete ")])),_:1})]),default:t(()=>[e(y,{onOnConfirm:async()=>{await x(Y)(c.id),p()},message:"¿Está seguro de eliminar este registro?"},null,8,["onOnConfirm"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["loadDataTable","headers"])]),_:1})}}});export{ie as default};
