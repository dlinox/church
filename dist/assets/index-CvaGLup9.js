import{y as P,z as T,d as A,b as _,r as o,o as c,c as p,w as e,a as t,u as w,g as V,f as M,q as B,v as h,F as j,h as F,i as I}from"./index-DkPFh2QW.js";import{i as Q}from"./DataTable.types-CX4v7_jN.js";import{r as G}from"./ruleUtils-Dk9EfJu0.js";const z="https://church-api.linox.net.pe/api/roles",W=async a=>{try{const n=P();return(await T(n,z).post("/load-data-table",a)).data.data}catch{return Q()}},X=async a=>{try{const n=P();return await T(n,z).post("/save",a),!0}catch{return!1}},Y=async a=>{try{const n=P();return await T(n,z).delete(`/delete/${a}`),!0}catch{return!1}},Z=async()=>{try{const a=P(),n=await T(a,z).get("/all-permissions");return console.log(n.data),n.data.data}catch{return[]}},ee=async a=>{try{const n=P();return await T(n,z).post("/assign-permissions/",a),!0}catch{return!1}},te=[{title:"Op.",key:"actions",value:"actions",fixed:!0,width:"50px",sortable:!1},{title:"Nombre",key:"displayName",value:"displayName"},{title:"Clave",key:"name",value:"name"}],oe={displayName:[G],permissions:[G]},ne=()=>({id:null,displayName:null,permissions:[]}),q=A({__name:"Form",props:{formState:{type:Object,default:()=>({})}},emits:["onSuccess"],setup(a,{emit:n}){const s=n,S=a,y=oe,v=_(null),u=_(!1),m=_(!1),l=_({...ne(),...S.formState}),g=async()=>{const{valid:k}=await v.value.validate();if(!k)return;u.value=!0,await X(l.value)&&(l.value.id==null&&v.value.reset(),s("onSuccess"),m.value=!1),u.value=!1};return(k,r)=>{const E=o("v-text-field"),i=o("v-col"),D=o("v-row"),f=o("v-card-item"),C=o("v-btn"),d=o("v-spacer"),b=o("v-card-actions"),N=o("v-card"),R=o("v-form"),U=o("v-dialog");return c(),p(U,{"max-width":"500",modelValue:m.value,"onUpdate:modelValue":r[2]||(r[2]=x=>m.value=x),activator:"parent"},{default:e(()=>[t(R,{ref_key:"formRef",ref:v,onSubmit:M(g,["prevent"])},{default:e(()=>[t(N,{title:l.value.id?"Editar Registro":"Nuevo Registro"},{default:e(()=>[t(f,{class:"border-t border-b"},{default:e(()=>[t(D,null,{default:e(()=>[t(i,{cols:"12"},{default:e(()=>[t(E,{modelValue:l.value.displayName,"onUpdate:modelValue":r[0]||(r[0]=x=>l.value.displayName=x),label:"Nombre",rules:w(y).displayName,autocomplete:"off"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),t(b,null,{default:e(()=>[t(C,{type:"button",variant:"text",color:"secondary",onClick:r[1]||(r[1]=x=>m.value=!1)},{default:e(()=>r[3]||(r[3]=[V(" Cancelar ")])),_:1}),t(d),t(C,{text:"Guardar",color:"primary",type:"submit",loading:u.value},null,8,["loading"])]),_:1})]),_:1},8,["title"])]),_:1},512)]),_:1},8,["modelValue"])}}}),ae=A({__name:"AssignPermissions",props:{roleId:{},permissions:{}},emits:["onSuccess"],setup(a,{emit:n}){const s=n,S=a,y=_({roleId:S.roleId,permissions:[]}),v=_(null),u=_(!1),m=_(!1),l=_([...S.permissions]),g=async()=>{m.value=!0,y.value.permissions=l.value,await ee(y.value),u.value=!1,m.value=!1,s("onSuccess")},k=_([]);return(async()=>{y.value.permissions=[],k.value=await Z()})(),(E,i)=>{const D=o("v-checkbox"),f=o("v-col"),C=o("v-row"),d=o("v-expansion-panel-text"),b=o("v-expansion-panel"),N=o("v-expansion-panels"),R=o("v-btn"),U=o("v-spacer"),x=o("v-card-actions"),L=o("v-card"),H=o("v-form"),J=o("v-dialog");return c(),p(J,{"max-width":"1000",modelValue:u.value,"onUpdate:modelValue":i[2]||(i[2]=O=>u.value=O),activator:"parent"},{default:e(()=>[t(H,{ref_key:"formRef",ref:v,onSubmit:M(g,["prevent"])},{default:e(()=>[t(L,{title:"Asignar permisos"},{default:e(()=>[t(N,null,{default:e(()=>[(c(!0),B(j,null,h(k.value,O=>(c(),p(b,{key:O.id,title:O.name},{default:e(()=>[t(d,null,{default:e(()=>[t(C,null,{default:e(()=>[(c(!0),B(j,null,h(O.children,$=>(c(),p(f,{cols:"12",sm:"6",md:"4",class:"ma-0 pa-1",key:$.id},{default:e(()=>[t(D,{modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=K=>l.value=K),label:$.name,value:$.id},null,8,["modelValue","label","value"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1}),t(x,null,{default:e(()=>[t(R,{type:"button",variant:"text",color:"secondary",onClick:i[1]||(i[1]=O=>u.value=!1)},{default:e(()=>i[3]||(i[3]=[V(" Cancelar ")])),_:1}),t(U),t(R,{text:"Guardar",color:"primary",type:"submit",loading:m.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue"])}}}),ie=A({__name:"index",setup(a){return(n,s)=>{const S=o("v-text-field"),y=o("v-col"),v=o("v-btn"),u=o("v-row"),m=o("v-card-item"),l=o("v-icon"),g=o("v-list-item"),k=o("LnxDialogConfirm"),r=o("v-list"),E=o("v-menu"),i=o("LnxDataTable"),D=o("v-card"),f=F("permission"),C=F("tooltip");return c(),p(D,{title:"Roles",subtitle:"Gestión de roles"},{default:e(()=>[t(i,{loadDataTable:w(W),headers:w(te)},{header:e(({request:d,loading:b,init:N,loadingTable:R,debouncedReload:U,reLoadDataTable:x})=>[t(m,{class:"border-t border-b"},{default:e(()=>[t(u,{class:"d-flex justify-space-between align-center"},{default:e(()=>[t(y,{cols:"12",md:"4"},{default:e(()=>[t(S,{modelValue:d.search,"onUpdate:modelValue":L=>d.search=L,label:"Buscar",clearable:"",onInput:U,"onClick:clear":x},null,8,["modelValue","onUpdate:modelValue","onInput","onClick:clear"])]),_:2},1024),t(y,{cols:"12",md:"4",class:"d-md-flex d-block justify-end text-end"},{default:e(()=>[I((c(),p(v,{class:"me-2",disabled:b},{default:e(()=>[s[0]||(s[0]=V(" nuevo ")),t(w(q),{onOnSuccess:N},null,8,["onOnSuccess"])]),_:2},1032,["disabled"])),[[f,["crear_rol"]]]),I(t(v,{density:"comfortable",icon:"mdi-reload",onClick:N,loading:R},null,8,["onClick","loading"]),[[C,"Recargar registros"]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.actions":e(({item:d,loadDataTable:b})=>[I((c(),p(v,{icon:"",size:"small",variant:"text"},{default:e(()=>[t(l,null,{default:e(()=>s[1]||(s[1]=[V(" mdi-dots-vertical ")])),_:1}),t(E,{activator:"parent"},{default:e(()=>[t(r,{nav:""},{default:e(()=>[I((c(),p(g,{title:"Asignar Permisos",density:"compact",value:"assign"},{prepend:e(()=>[t(l,{size:"small"},{default:e(()=>s[2]||(s[2]=[V(" mdi-shield-account ")])),_:1})]),default:e(()=>[t(w(ae),{roleId:d.id,permissions:d.permissions,onOnSuccess:b},null,8,["roleId","permissions","onOnSuccess"])]),_:2},1024)),[[f,["asignar_permisos"]]]),I((c(),p(g,{title:"Editar",density:"compact",value:"edit"},{prepend:e(()=>[t(l,{size:"small"},{default:e(()=>s[3]||(s[3]=[V(" mdi-pencil ")])),_:1})]),default:e(()=>[t(w(q),{formState:d,onOnSuccess:b},null,8,["formState","onOnSuccess"])]),_:2},1024)),[[f,["editar_rol"]]]),I((c(),p(g,{title:"Eliminar",class:"text-red",density:"compact",value:"delete"},{prepend:e(()=>[t(l,{size:"small"},{default:e(()=>s[4]||(s[4]=[V(" mdi-delete ")])),_:1})]),default:e(()=>[t(k,{onOnConfirm:async()=>{await w(Y)(d.id),b()},message:"¿Está seguro de eliminar este registro?"},null,8,["onOnConfirm"])]),_:2},1024)),[[f,["eliminar_rol"]]])]),_:2},1024)]),_:2},1024)]),_:2},1024)),[[f,["asignar_permisos","editar_rol","eliminar_rol"]]])]),_:1},8,["loadDataTable","headers"])]),_:1})}}});export{ie as default};
