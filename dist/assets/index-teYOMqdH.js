import{y as L,z as j,d as M,b as _,r as o,o as f,c as b,w as t,a as e,u as v,A as P,g as x,f as q,h as G,i as I,t as J}from"./index-CJ0P2Z7N.js";import{r as S,e as K}from"./ruleUtils-Dk9EfJu0.js";import{i as Q}from"./DataTable.types-CX4v7_jN.js";import{_ as W}from"./selectItems.services-W5ZJhLi5.js";const D={name:[S],email:[S,K],username:[S],password:[],status:[S],role:[S]},H=()=>({id:null,name:null,email:"",password:null,username:"",role:null,status:!0}),B="https://church-api.linox.net.pe/api/users",X=async i=>{try{const s=L();return(await j(s,B).post("/load-data-table",i)).data.data}catch{return Q()}},Y=async i=>{try{const s=L();return await j(s,B).post("/save",i),!0}catch(s){return(s==null?void 0:s.status)==422?s.response.data:!1}},Z=async i=>{try{const s=L();return await j(s,B).delete(`/delete/${i}`),!0}catch{return!1}},F=M({__name:"Form",props:{formState:{type:Object,default:()=>({})},roleItems:{type:Array,default:()=>[]}},emits:["onSuccess"],setup(i,{emit:s}){const R=s,A=i,r=_(null),y=_(!1),p=_(!1),d=_(!1),l=_({...H(),...A.formState}),m=_({}),k=async()=>{if(y.value)return;m.value={};const{valid:C}=await r.value.validate();if(!C)return;y.value=!0;const a=await Y(l.value);a&&(a.errors?m.value=a.errors:(l.value.id==null&&(l.value=H()),R("onSuccess"),p.value=!1)),y.value=!1};return(C,a)=>{const w=o("v-text-field"),c=o("v-col"),O=o("v-select"),T=o("v-switch"),V=o("v-row"),E=o("v-card-item"),u=o("v-btn"),g=o("v-spacer"),U=o("v-card-actions"),N=o("v-card"),$=o("v-form"),z=o("v-dialog");return f(),b(z,{"max-width":"500",modelValue:p.value,"onUpdate:modelValue":a[8]||(a[8]=n=>p.value=n),activator:"parent"},{default:t(()=>[e($,{ref_key:"formRef",ref:r,onSubmit:q(k,["prevent"])},{default:t(()=>[e(N,{title:l.value.id?"Editar Registro":"Nuevo Registro"},{default:t(()=>[e(E,{class:"border-t border-b"},{default:t(()=>[e(V,null,{default:t(()=>[e(c,{cols:"12"},{default:t(()=>[e(w,{modelValue:l.value.name,"onUpdate:modelValue":a[0]||(a[0]=n=>l.value.name=n),label:"Nombre completo",rules:v(D).name,autocomplete:"off","error-messages":m.value.name},null,8,["modelValue","rules","error-messages"])]),_:1}),e(c,{cols:"12"},{default:t(()=>[e(w,{modelValue:l.value.email,"onUpdate:modelValue":a[1]||(a[1]=n=>l.value.email=n),label:"Correo electrónico",rules:v(D).email,autocomplete:"off","error-messages":m.value.email},null,8,["modelValue","rules","error-messages"])]),_:1}),e(c,{cols:"12"},{default:t(()=>[e(w,{modelValue:l.value.username,"onUpdate:modelValue":a[2]||(a[2]=n=>l.value.username=n),label:"Usuario",rules:v(D).username,autocomplete:"off","error-messages":m.value.username},null,8,["modelValue","rules","error-messages"])]),_:1}),l.value.id?P("",!0):(f(),b(c,{key:0,cols:"12"},{default:t(()=>[e(w,{modelValue:l.value.password,"onUpdate:modelValue":a[3]||(a[3]=n=>l.value.password=n),label:"Contraseña",rules:v(D).password,type:d.value?"text":"password",autocomplete:"new-password","append-inner-icon":d.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":a[4]||(a[4]=n=>d.value=!d.value),"error-messages":m.value.password},null,8,["modelValue","rules","type","append-inner-icon","error-messages"])]),_:1})),e(c,{cols:"12"},{default:t(()=>[e(O,{modelValue:l.value.role,"onUpdate:modelValue":a[5]||(a[5]=n=>l.value.role=n),items:i.roleItems,label:"Rol",autocomplete:"off",rules:v(D).role,"error-messages":m.value.role},null,8,["modelValue","items","rules","error-messages"])]),_:1}),e(c,{cols:"12"},{default:t(()=>[e(T,{label:l.value.status?"Habilitado":"Deshabilitado",modelValue:l.value.status,"onUpdate:modelValue":a[6]||(a[6]=n=>l.value.status=n),color:"blue-darken-4",inset:""},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1}),e(U,null,{default:t(()=>[e(u,{type:"button",variant:"text",color:"secondary",onClick:a[7]||(a[7]=n=>p.value=!1)},{default:t(()=>a[9]||(a[9]=[x(" Cancelar ")])),_:1}),e(g),e(u,{text:"Guardar",color:"primary",type:"submit",loading:y.value},null,8,["loading"])]),_:1})]),_:1},8,["title"])]),_:1},512)]),_:1},8,["modelValue"])}}}),h=[{title:"Op.",key:"actions",value:"actions",fixed:!0,width:"50px",sortable:!1},{title:"Nombre",key:"name",value:"name"},{title:"Correo",key:"email",value:"email"},{title:"Usuario",key:"username",value:"username"},{title:"Rol",key:"role",value:"role.title"},{title:"Estado",key:"status",value:"status"}],le=M({__name:"index",setup(i){const s=_([]);return(async()=>{s.value=await W()})(),(A,r)=>{const y=o("v-text-field"),p=o("v-col"),d=o("v-btn"),l=o("v-row"),m=o("v-card-item"),k=o("v-icon"),C=o("v-list-item"),a=o("LnxDialogConfirm"),w=o("v-list"),c=o("v-menu"),O=o("LnxDataTable"),T=o("v-card"),V=G("permission"),E=G("tooltip");return f(),b(T,{title:"Usuarios",subtitle:"Gestión de usuarios"},{default:t(()=>[e(O,{loadDataTable:v(X),headers:v(h)},{header:t(({request:u,loading:g,init:U,loadingTable:N,debouncedReload:$,reLoadDataTable:z})=>[e(m,{class:"border-t border-b"},{default:t(()=>[e(l,{class:"d-flex justify-space-between"},{default:t(()=>[e(p,{cols:"12",md:"4"},{default:t(()=>[e(y,{modelValue:u.search,"onUpdate:modelValue":n=>u.search=n,label:"Buscar",clearable:"",onInput:$,"onClick:clear":z},null,8,["modelValue","onUpdate:modelValue","onInput","onClick:clear"])]),_:2},1024),e(p,{cols:"12",md:"4",class:"d-flex justify-end"},{default:t(()=>[I((f(),b(d,{class:"me-1",disabled:g},{default:t(()=>[e(F,{roleItems:s.value,onOnSuccess:U},null,8,["roleItems","onOnSuccess"]),r[0]||(r[0]=x(" nuevo "))]),_:2},1032,["disabled"])),[[V,["crear_usuario"]]]),I(e(d,{density:"comfortable",icon:"mdi-reload",onClick:U,loading:N},null,8,["onClick","loading"]),[[E,"Recargar registros"]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.actions":t(({item:u,loadDataTable:g})=>[I((f(),b(d,{icon:"",size:"small",variant:"text"},{default:t(()=>[e(k,null,{default:t(()=>r[1]||(r[1]=[x(" mdi-dots-vertical ")])),_:1}),e(c,{activator:"parent"},{default:t(()=>[e(w,{nav:""},{default:t(()=>[I((f(),b(C,{title:"Editar",density:"compact",value:"edit"},{prepend:t(()=>[e(k,{size:"small"},{default:t(()=>r[2]||(r[2]=[x(" mdi-pencil ")])),_:1})]),default:t(()=>[e(F,{roleItems:s.value,formState:u,onOnSuccess:U=>g()},null,8,["roleItems","formState","onOnSuccess"])]),_:2},1024)),[[V,["editar_usuario"]]]),I((f(),b(C,{title:"Eliminar",class:"text-red",density:"compact",value:"delete"},{prepend:t(()=>[e(k,{size:"small"},{default:t(()=>r[3]||(r[3]=[x(" mdi-delete ")])),_:1})]),default:t(()=>[e(a,{onOnConfirm:async()=>{await v(Z)(u.id),g()},message:"¿Está seguro de eliminar este registro?"},null,8,["onOnConfirm"])]),_:2},1024)),[[V,["eliminar_usuario"]]])]),_:2},1024)]),_:2},1024)]),_:2},1024)),[[V,["editar_usuario","eliminar_usuario"]]])]),"item.status":t(({item:u})=>[e(d,{color:u.status?"blue":"error",density:"compact",variant:"tonal"},{default:t(()=>[x(J(u.status?"Habilitado":"Deshabilitado"),1)]),_:2},1032,["color"])]),_:1},8,["loadDataTable","headers"])]),_:1})}}});export{le as default};
