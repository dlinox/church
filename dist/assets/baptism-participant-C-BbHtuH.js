import{y as Q,z as W,d as j,B as G,b as x,r as a,o as V,c as k,w as l,a as e,g as b,e as O,f as X,C as ae,q as ne,F as se,h as q,i as S,t as E,u as H,A as L}from"./index-CJ0P2Z7N.js";import{b as re,c as ue}from"./sacrament-records.services-COxbs5mB.js";import{b as de}from"./sacrament.services-DrLqVscL.js";import{a as ie}from"./sacrament.constants-DfR_xNh6.js";import{_ as N,a as ce,b as me,c as pe}from"./AnnularActForm.vue_vue_type_script_setup_true_lang-CCAvF_qq.js";import{b as _e}from"./selectItems.services-W5ZJhLi5.js";import{c as ve}from"./index-CqUbEfsn.js";import{_ as fe}from"./PrintAct.vue_vue_type_script_setup_true_lang-C9-dVffz.js";import"./DataTable.types-CX4v7_jN.js";import"./Form.vue_vue_type_script_setup_true_lang-VHOY459I.js";import"./ruleUtils-Dk9EfJu0.js";const Y="https://church-api.linox.net.pe/api/sacrament-records",Z=async U=>{try{const y=Q();return await W(y,Y).post("/save",U),!0}catch{return!1}},be=async U=>{try{const y=Q();return(await W(y,Y).get(`/get-record-by-id/${U}`)).data.data}catch{return null}},ye=j({__name:"BaptismParticipantForm",emits:["onSuccess"],setup(U,{emit:y}){const w=G(),F=y,P=x(null),I=x(!1),n=x(!1),v=x(!1),g=()=>({id:null,sacramentId:null,sacramentBookId:null,folioNumber:null,actNumber:null,observations:null,canonical:!1,issued:!1,roles:[{role:"1",personId:null,family:[{role:"1",personId:null},{role:"2",personId:null}]},{role:"4",personId:null},{role:"5",personId:null}]}),d=x({...g()}),o=async()=>{var r;d.value.issued=v.value,d.value.sacramentId=parseInt((r=w.params.id)==null?void 0:r.toString()),I.value=!0,await Z(d.value)&&(F("onSuccess"),d.value=g(),n.value=!1),I.value=!1,console.log("submit",d.value)};return(D,r)=>{const R=a("v-spacer"),B=a("v-icon"),C=a("v-btn"),$=a("v-toolbar"),z=a("v-card-item"),c=a("v-col"),t=a("v-row"),f=a("v-card-text"),_=a("v-card-actions"),s=a("v-card"),p=a("v-form"),i=a("v-dialog");return V(),k(i,{modelValue:n.value,"onUpdate:modelValue":r[7]||(r[7]=m=>n.value=m),"max-width":"1000",activator:"parent",scrollable:""},{default:l(()=>[e(p,{ref_key:"formRef",ref:P,onSubmit:X(o,["prevent"])},{default:l(()=>[e(s,{rounded:"0"},{default:l(()=>[e($,{color:"gray",title:d.value.id?"Editar Registro":"Nuevo Participante"},{default:l(()=>[e(R),e(C,{icon:"",onClick:r[0]||(r[0]=m=>n.value=!1),color:"secondary",density:"compact"},{default:l(()=>[e(B,null,{default:l(()=>r[8]||(r[8]=[b("mdi-close")])),_:1})]),_:1})]),_:1},8,["title"]),e(f,{class:"pa-0"},{default:l(()=>[e(t,{"no-gutters":""},{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(z,null,{default:l(()=>r[9]||(r[9]=[O("span",{class:"text-subtitle-2 text-secondary"}," Información de la(s) persona(s) ",-1)])),_:1}),e(t,{"no-gutters":""},{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(N,{family:"",modelValue:d.value.roles[0],"onUpdate:modelValue":r[1]||(r[1]=m=>d.value.roles[0]=m),title:"Bautizado"},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(N,{modelValue:d.value.roles[0].family[0],"onUpdate:modelValue":r[2]||(r[2]=m=>d.value.roles[0].family[0]=m),title:"Padre"},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(N,{modelValue:d.value.roles[0].family[1],"onUpdate:modelValue":r[3]||(r[3]=m=>d.value.roles[0].family[1]=m),title:"Madre"},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(N,{modelValue:d.value.roles[1],"onUpdate:modelValue":r[4]||(r[4]=m=>d.value.roles[1]=m),title:"Padrino"},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(N,{modelValue:d.value.roles[2],"onUpdate:modelValue":r[5]||(r[5]=m=>d.value.roles[2]=m),title:"Madrina"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(_,{class:"border-t"},{default:l(()=>[e(C,{type:"button",variant:"text",color:"secondary",onClick:r[6]||(r[6]=m=>n.value=!1)},{default:l(()=>r[10]||(r[10]=[b(" Cancelar ")])),_:1}),e(R),e(C,{text:"Guardar",color:"primary",type:"submit",loading:I.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue"])}}}),K=j({__name:"FormAct",props:{recordId:{}},emits:["onSuccess"],setup(U,{emit:y}){const w=G(),F=y,P=U,I=x(null),n=x(!1),v=x(!1),g=x(!1),d=()=>({id:null,sacramentId:null,sacramentBookId:null,folioNumber:null,actNumber:null,observations:null,canonical:!1,issued:!1,roles:[{role:"1",personId:null,family:[{role:"1",personId:null},{role:"2",personId:null}]},{role:"4",personId:null},{role:"5",personId:null}]}),o=x({...d()}),D=async c=>{o.value=d();let t=await be(c);o.value.id=t.id,o.value.sacramentBookId=t.sacramentBookId,o.value.sacramentBookId==null&&$(),o.value.folioNumber=t.folioNumber,o.value.actNumber=t.actNumber,o.value.observations=t.observations,o.value.canonical=t.canonical,o.value.issued=t.issued,t.roles.forEach(f=>{o.value.roles.map(_=>{_.role==f.role&&(_.personId=f.personId,_.family&&f.family&&_.family.map(s=>{f.family.map(p=>{s.role==p.role&&(s.personId=p.personId)})}))})})},r=async c=>{let t=await ve(c);o.value.folioNumber=t.next.folioNumber,o.value.actNumber=t.next.actNumber},R=async c=>await _e("1",c),B=()=>{g.value=!0,C()},C=async()=>{var t;o.value.issued=g.value,o.value.sacramentId=parseInt((t=w.params.id)==null?void 0:t.toString()),n.value=!0,await Z(o.value)&&(F("onSuccess"),o.value=d(),v.value=!1),n.value=!1,console.log("submit",o.value)},$=()=>{let c=localStorage.getItem("baptismParameters");if(c){let t=JSON.parse(c);o.value.sacramentBookId=t.defaultBook,r(t.defaultBook.value)}},z=async()=>{P.recordId?await D(P.recordId):$()};return ae(()=>v.value,c=>{c&&z()}),(c,t)=>{const f=a("v-spacer"),_=a("v-icon"),s=a("v-btn"),p=a("v-toolbar"),i=a("v-col"),m=a("v-text-field"),M=a("v-textarea"),T=a("v-checkbox"),A=a("v-row"),J=a("v-card-item"),h=a("v-card-text"),ee=a("v-card-actions"),le=a("v-card"),te=a("v-form"),oe=a("v-dialog");return V(),k(oe,{modelValue:v.value,"onUpdate:modelValue":t[12]||(t[12]=u=>v.value=u),activator:"parent",fullscreen:"",scrollable:""},{default:l(()=>[e(te,{ref_key:"formRef",ref:I,onSubmit:X(C,["prevent"])},{default:l(()=>[e(le,{rounded:"0"},{default:l(()=>[e(p,{color:"gray",title:o.value.id?"Editar Registro":"Nuevo Registro"},{default:l(()=>[e(f),e(s,{icon:"",onClick:t[0]||(t[0]=u=>v.value=!1),color:"secondary",density:"compact"},{default:l(()=>[e(_,null,{default:l(()=>t[13]||(t[13]=[b("mdi-close")])),_:1})]),_:1})]),_:1},8,["title"]),e(h,{class:"pa-0"},{default:l(()=>[e(A,{"no-gutters":"",class:"h-100"},{default:l(()=>[e(i,{cols:"12",md:"3",class:"border-e"},{default:l(()=>[e(J,null,{default:l(()=>[e(A,null,{default:l(()=>[e(i,{cols:"12"},{default:l(()=>t[14]||(t[14]=[O("span",{class:"text-subtitle-2 text-secondary"}," Información del acta ",-1)])),_:1}),e(i,{cols:"12",md:"12",xl:"6"},{default:l(()=>[e(ce,{modelValue:o.value.sacramentBookId,"onUpdate:modelValue":[t[1]||(t[1]=u=>o.value.sacramentBookId=u),t[2]||(t[2]=u=>u!=null?r(u.value):()=>{})],service:R,label:"Libro",autocomplete:"off","return-object":""},null,8,["modelValue"])]),_:1}),e(i,{cols:"6",md:"6",xl:"3"},{default:l(()=>[e(m,{modelValue:o.value.folioNumber,"onUpdate:modelValue":t[3]||(t[3]=u=>o.value.folioNumber=u),label:"Folio"},null,8,["modelValue"])]),_:1}),e(i,{cols:"6",md:"6",xl:"3"},{default:l(()=>[e(m,{modelValue:o.value.actNumber,"onUpdate:modelValue":t[4]||(t[4]=u=>o.value.actNumber=u),label:"Acta"},null,8,["modelValue"])]),_:1}),e(i,{cols:"12"},{default:l(()=>[e(M,{label:"Observaciones",rows:"3"})]),_:1}),e(i,{cols:"12"},{default:l(()=>[e(T,{modelValue:o.value.canonical,"onUpdate:modelValue":t[5]||(t[5]=u=>o.value.canonical=u),color:"primary",label:"Cumple con las normas del Derecho Canónico"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(i,{cols:"12",md:"9"},{default:l(()=>[e(J,null,{default:l(()=>t[15]||(t[15]=[O("span",{class:"text-subtitle-2 text-secondary"}," Información de la(s) persona(s) ",-1)])),_:1}),e(A,{"no-gutters":""},{default:l(()=>[e(i,{cols:"12"},{default:l(()=>[e(N,{family:"",modelValue:o.value.roles[0],"onUpdate:modelValue":t[6]||(t[6]=u=>o.value.roles[0]=u),title:"Bautizado"},null,8,["modelValue"])]),_:1}),e(i,{cols:"6"},{default:l(()=>[e(N,{modelValue:o.value.roles[0].family[0],"onUpdate:modelValue":t[7]||(t[7]=u=>o.value.roles[0].family[0]=u),title:"Padre"},null,8,["modelValue"])]),_:1}),e(i,{cols:"6"},{default:l(()=>[e(N,{modelValue:o.value.roles[0].family[1],"onUpdate:modelValue":t[8]||(t[8]=u=>o.value.roles[0].family[1]=u),title:"Madre"},null,8,["modelValue"])]),_:1}),e(i,{cols:"6"},{default:l(()=>[e(N,{modelValue:o.value.roles[1],"onUpdate:modelValue":t[9]||(t[9]=u=>o.value.roles[1]=u),title:"Padrino"},null,8,["modelValue"])]),_:1}),e(i,{cols:"6"},{default:l(()=>[e(N,{modelValue:o.value.roles[2],"onUpdate:modelValue":t[10]||(t[10]=u=>o.value.roles[2]=u),title:"Madrina"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ee,{class:"border-t"},{default:l(()=>[e(s,{type:"button",variant:"text",color:"secondary",onClick:t[11]||(t[11]=u=>v.value=!1)},{default:l(()=>t[16]||(t[16]=[b(" Cancelar ")])),_:1}),e(f),e(s,{text:"Asentar y guardar",color:"primary","prepend-icon":"mdi-file-certificate-outline",variant:"outlined",type:"button",onClick:B,loading:n.value},null,8,["loading"]),e(s,{text:"Guardar",color:"primary",type:"submit",loading:n.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue"])}}}),ge={class:"text-h6"},Ve={class:"text-subtitle-2"},xe={class:"text-subtitle-2"},$e=j({__name:"baptism-participant",setup(U){const y=G(),w=x(null),F=async I=>{const n=y.params.id;return await ue(I,Number(n))};return(async()=>{const I=y.params.id;w.value=await de(Number(I))})(),(I,n)=>{const v=a("v-icon"),g=a("v-btn"),d=a("v-card-item"),o=a("v-text-field"),D=a("v-col"),r=a("v-row"),R=a("v-chip"),B=a("v-list-item"),C=a("LnxDialogConfirm"),$=a("v-list"),z=a("v-menu"),c=a("LnxDataTable"),t=a("v-card"),f=q("tooltip"),_=q("permission");return V(),ne(se,null,[e(t,{title:"Registro de participantes",subtitle:"Gestión de participantes en el sacramento"},{append:l(()=>[S((V(),k(g,{icon:"",density:"compact",variant:"tonal"},{default:l(()=>[e(me,{type:"1"}),e(v,null,{default:l(()=>n[0]||(n[0]=[b("mdi-tune-variant")])),_:1})]),_:1})),[[f,"Definir Parámetros"]])]),default:l(()=>[e(d,{class:"border-t"},{default:l(()=>{var s,p,i;return[O("p",ge,E((s=w.value)==null?void 0:s.dateFormatted),1),O("p",Ve,E((p=w.value)==null?void 0:p.parish),1),O("p",xe,E((i=w.value)==null?void 0:i.minister),1)]}),_:1}),e(c,{loadDataTable:F,headers:H(ie)},{header:l(({request:s,loading:p,init:i,loadingTable:m,debouncedReload:M,reLoadDataTable:T})=>[e(d,{class:"border-t border-b"},{default:l(()=>[e(r,{class:"d-flex justify-space-between align-center"},{default:l(()=>[e(D,{cols:"12",md:"4"},{default:l(()=>[e(o,{modelValue:s.search,"onUpdate:modelValue":A=>s.search=A,label:"Buscar",clearable:"",onInput:M,"onClick:clear":T},null,8,["modelValue","onUpdate:modelValue","onInput","onClick:clear"])]),_:2},1024),e(D,{cols:"12",md:"4",class:"d-md-flex d-block justify-end text-end"},{default:l(()=>[S((V(),k(g,{"prepend-icon":"mdi-plus",class:"me-2",disabled:p},{default:l(()=>[n[1]||(n[1]=b(" acta ")),e(K,{onOnSuccess:i},null,8,["onOnSuccess"])]),_:2},1032,["disabled"])),[[_,["crear_acta_bautismo"]]]),S((V(),k(g,{"prepend-icon":"mdi-plus",class:"me-2",disabled:p},{default:l(()=>[n[2]||(n[2]=b(" participante ")),e(ye,{onOnSuccess:i},null,8,["onOnSuccess"])]),_:2},1032,["disabled"])),[[_,["agregar_participante_bautismo"]]]),S(e(g,{density:"comfortable",icon:"mdi-reload",onClick:i,loading:m},null,8,["onClick","loading"]),[[f,"Recargar registros"]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.status":l(({item:s})=>[e(R,{color:s.status?"blue":"error",variant:"outlined"},{default:l(()=>[b(E(s.status?"Activo":" Anulado "),1)]),_:2},1032,["color"])]),"item.actions":l(({item:s,loadDataTable:p})=>[S((V(),k(g,{icon:"",size:"small",variant:"text",disabled:!s.status},{default:l(()=>[e(v,null,{default:l(()=>n[3]||(n[3]=[b(" mdi-dots-vertical ")])),_:1}),e(z,{activator:"parent"},{default:l(()=>[e($,{nav:""},{default:l(()=>[s.status&&s.issueDate===null?S((V(),k(B,{key:0,title:"Editar",density:"compact",value:"edit"},{prepend:l(()=>[e(v,{size:"small"},{default:l(()=>n[4]||(n[4]=[b(" mdi-pencil ")])),_:1})]),default:l(()=>[e(K,{recordId:s.id,onOnSuccess:p},null,8,["recordId","onOnSuccess"])]),_:2},1024)),[[_,["editar_acta_bautismo"]]]):L("",!0),s.status&&s.issueDate!==null?S((V(),k(B,{key:1,title:"Imprimir Acta",density:"compact",value:"print"},{prepend:l(()=>[e(v,{size:"small"},{default:l(()=>n[5]||(n[5]=[b(" mdi-printer ")])),_:1})]),default:l(()=>[e(fe,{record:s,onOnSuccess:p},null,8,["record","onOnSuccess"])]),_:2},1024)),[[_,["imprimir_acta_bautismo"]]]):L("",!0),s.status&&s.issueDate!==null?S((V(),k(B,{key:2,title:"Anular",class:"text-red",density:"compact",value:"annular"},{prepend:l(()=>[e(v,{size:"small"},{default:l(()=>n[6]||(n[6]=[b(" mdi-minus-circle-outline ")])),_:1})]),default:l(()=>[e(pe,{onOnSuccess:p,record:s},null,8,["onOnSuccess","record"])]),_:2},1024)),[[_,["anular_acta_bautismo"]]]):L("",!0),s.issueDate==null?S((V(),k(B,{key:3,title:"Eliminar",class:"text-red",density:"compact",value:"delete"},{prepend:l(()=>[e(v,{size:"small"},{default:l(()=>n[7]||(n[7]=[b(" mdi-delete ")])),_:1})]),default:l(()=>[e(C,{onOnConfirm:async()=>{await H(re)(s.id),p()},message:"¿Está seguro de eliminar este registro?"},null,8,["onOnConfirm"])]),_:2},1024)),[[_,["eliminar_acta_bautismo"]]]):L("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["disabled"])),[[_,["editar_acta_bautismo","imprimir_acta_bautismo","anular_acta_bautismo","eliminar_acta_bautismo"]],[f,"Opciones"]])]),_:1},8,["headers"])]),_:1}),n[8]||(n[8]=O("iframe",{id:"printFrame",style:{display:"none"}},null,-1))],64)}}});export{$e as default};
