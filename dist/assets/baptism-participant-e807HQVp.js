import{y as W,z as X,d as j,B as G,b as I,r as a,o as g,c as x,w as l,a as e,g as b,e as $,f as Y,C as ae,h as H,i as S,t as F,A as L,u as K}from"./index-CVCjnSgw.js";import{b as ne,c as se}from"./sacrament-records.services-BZrvOhck.js";import{b as re,c as ue}from"./sacrament.constants-CgpqCj2C.js";import{_ as N,a as de,b as ie,c as ce}from"./AnnularActForm.vue_vue_type_script_setup_true_lang-Dkn1F1in.js";import{b as me}from"./selectItems.services-BNeHz74L.js";import{c as pe}from"./index-BsR6qMHu.js";import{_ as _e}from"./PrintAct.vue_vue_type_script_setup_true_lang-lOo3QKW3.js";import"./DataTable.types-CX4v7_jN.js";import"./Form.vue_vue_type_script_setup_true_lang-CbbcxHqI.js";import"./ruleUtils-Dk9EfJu0.js";const Z="https://church-api.linox.net.pe/api/sacrament-records",q=async U=>{try{const y=W();return await X(y,Z).post("/save",U),!0}catch{return!1}},ve=async U=>{try{const y=W();return(await X(y,Z).get(`/get-record-by-id/${U}`)).data.data}catch{return null}},fe=j({__name:"BaptismParticipantForm",emits:["onSuccess"],setup(U,{emit:y}){const w=G(),P=y,z=I(null),k=I(!1),r=I(!1),v=I(!1),V=()=>({id:null,sacramentId:null,sacramentBookId:null,folioNumber:null,actNumber:null,observations:null,canonical:!1,issued:!1,roles:[{role:"1",personId:null,family:[{role:"1",personId:null},{role:"2",personId:null}]},{role:"4",personId:null},{role:"5",personId:null}]}),d=I({...V()}),o=async()=>{var s;d.value.issued=v.value,d.value.sacramentId=parseInt((s=w.params.id)==null?void 0:s.toString()),k.value=!0,await q(d.value)&&(P("onSuccess"),d.value=V(),r.value=!1),k.value=!1};return(O,s)=>{const D=a("v-spacer"),B=a("v-icon"),C=a("v-btn"),R=a("v-toolbar"),A=a("v-card-item"),c=a("v-col"),t=a("v-row"),f=a("v-card-text"),_=a("v-card-actions"),n=a("v-card"),p=a("v-form"),i=a("v-dialog");return g(),x(i,{modelValue:r.value,"onUpdate:modelValue":s[7]||(s[7]=m=>r.value=m),"max-width":"1000",activator:"parent",scrollable:""},{default:l(()=>[e(p,{ref_key:"formRef",ref:z,onSubmit:Y(o,["prevent"])},{default:l(()=>[e(n,{rounded:"0"},{default:l(()=>[e(R,{color:"gray",title:d.value.id?"Editar Registro":"Nuevo Participante"},{default:l(()=>[e(D),e(C,{icon:"",onClick:s[0]||(s[0]=m=>r.value=!1),color:"secondary",density:"compact"},{default:l(()=>[e(B,null,{default:l(()=>s[8]||(s[8]=[b("mdi-close")])),_:1})]),_:1})]),_:1},8,["title"]),e(f,{class:"pa-0"},{default:l(()=>[e(t,{"no-gutters":""},{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(A,null,{default:l(()=>s[9]||(s[9]=[$("span",{class:"text-subtitle-2 text-secondary"}," Información de la(s) persona(s) ",-1)])),_:1}),e(t,{"no-gutters":""},{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(N,{family:"",modelValue:d.value.roles[0],"onUpdate:modelValue":s[1]||(s[1]=m=>d.value.roles[0]=m),title:"Bautizado"},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(N,{modelValue:d.value.roles[0].family[0],"onUpdate:modelValue":s[2]||(s[2]=m=>d.value.roles[0].family[0]=m),title:"Padre"},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(N,{modelValue:d.value.roles[0].family[1],"onUpdate:modelValue":s[3]||(s[3]=m=>d.value.roles[0].family[1]=m),title:"Madre"},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(N,{modelValue:d.value.roles[1],"onUpdate:modelValue":s[4]||(s[4]=m=>d.value.roles[1]=m),title:"Padrino"},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(N,{modelValue:d.value.roles[2],"onUpdate:modelValue":s[5]||(s[5]=m=>d.value.roles[2]=m),title:"Madrina"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(_,{class:"border-t"},{default:l(()=>[e(C,{type:"button",variant:"text",color:"secondary",onClick:s[6]||(s[6]=m=>r.value=!1)},{default:l(()=>s[10]||(s[10]=[b(" Cancelar ")])),_:1}),e(D),e(C,{text:"Guardar",color:"primary",type:"submit",loading:k.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue"])}}}),Q=j({__name:"FormAct",props:{recordId:{}},emits:["onSuccess"],setup(U,{emit:y}){const w=G(),P=y,z=U,k=I(null),r=I(!1),v=I(!1),V=I(!1),d=()=>({id:null,sacramentId:null,sacramentBookId:null,folioNumber:null,actNumber:null,observations:null,canonical:!1,issued:!1,roles:[{role:"1",personId:null,family:[{role:"1",personId:null},{role:"2",personId:null}]},{role:"4",personId:null},{role:"5",personId:null}]}),o=I({...d()}),O=async c=>{o.value=d();let t=await ve(c);o.value.id=t.id,o.value.sacramentBookId=t.sacramentBookId,o.value.sacramentBookId==null&&R(),o.value.folioNumber=t.folioNumber,o.value.actNumber=t.actNumber,o.value.observations=t.observations,o.value.canonical=t.canonical,o.value.issued=t.issued,t.roles.forEach(f=>{o.value.roles.map(_=>{_.role==f.role&&(_.personId=f.personId,_.family&&f.family&&_.family.map(n=>{f.family.map(p=>{n.role==p.role&&(n.personId=p.personId)})}))})})},s=async c=>{let t=await pe(c);o.value.folioNumber=t.next.folioNumber,o.value.actNumber=t.next.actNumber},D=async c=>await me("1",c),B=()=>{V.value=!0,C()},C=async()=>{var t;o.value.issued=V.value,o.value.sacramentId=parseInt((t=w.params.id)==null?void 0:t.toString()),r.value=!0,await q(o.value)&&(P("onSuccess"),o.value=d(),v.value=!1),r.value=!1},R=()=>{let c=localStorage.getItem("baptismParameters");if(c){let t=JSON.parse(c);o.value.sacramentBookId=t.defaultBook,s(t.defaultBook.value)}},A=async()=>{z.recordId?await O(z.recordId):R()};return ae(()=>v.value,c=>{c&&A()}),(c,t)=>{const f=a("v-spacer"),_=a("v-icon"),n=a("v-btn"),p=a("v-toolbar"),i=a("v-col"),m=a("v-text-field"),M=a("v-textarea"),T=a("v-checkbox"),E=a("v-row"),J=a("v-card-item"),h=a("v-card-text"),ee=a("v-card-actions"),le=a("v-card"),te=a("v-form"),oe=a("v-dialog");return g(),x(oe,{modelValue:v.value,"onUpdate:modelValue":t[12]||(t[12]=u=>v.value=u),activator:"parent",fullscreen:"",scrollable:""},{default:l(()=>[e(te,{ref_key:"formRef",ref:k,onSubmit:Y(C,["prevent"])},{default:l(()=>[e(le,{rounded:"0"},{default:l(()=>[e(p,{color:"gray",title:o.value.id?"Editar Registro":"Nuevo Registro"},{default:l(()=>[e(f),e(n,{icon:"",onClick:t[0]||(t[0]=u=>v.value=!1),color:"secondary",density:"compact"},{default:l(()=>[e(_,null,{default:l(()=>t[13]||(t[13]=[b("mdi-close")])),_:1})]),_:1})]),_:1},8,["title"]),e(h,{class:"pa-0"},{default:l(()=>[e(E,{"no-gutters":"",class:"h-100"},{default:l(()=>[e(i,{cols:"12",md:"3",class:"border-e"},{default:l(()=>[e(J,null,{default:l(()=>[e(E,null,{default:l(()=>[e(i,{cols:"12"},{default:l(()=>t[14]||(t[14]=[$("span",{class:"text-subtitle-2 text-secondary"}," Información del acta ",-1)])),_:1}),e(i,{cols:"12",md:"12",xl:"6"},{default:l(()=>[e(de,{modelValue:o.value.sacramentBookId,"onUpdate:modelValue":[t[1]||(t[1]=u=>o.value.sacramentBookId=u),t[2]||(t[2]=u=>u!=null?s(u.value):()=>{})],service:D,label:"Libro",autocomplete:"off","min-chars":1,"return-object":""},null,8,["modelValue"])]),_:1}),e(i,{cols:"6",md:"6",xl:"3"},{default:l(()=>[e(m,{modelValue:o.value.folioNumber,"onUpdate:modelValue":t[3]||(t[3]=u=>o.value.folioNumber=u),label:"Folio"},null,8,["modelValue"])]),_:1}),e(i,{cols:"6",md:"6",xl:"3"},{default:l(()=>[e(m,{modelValue:o.value.actNumber,"onUpdate:modelValue":t[4]||(t[4]=u=>o.value.actNumber=u),label:"Acta"},null,8,["modelValue"])]),_:1}),e(i,{cols:"12"},{default:l(()=>[e(M,{label:"Observaciones",rows:"3"})]),_:1}),e(i,{cols:"12"},{default:l(()=>[e(T,{modelValue:o.value.canonical,"onUpdate:modelValue":t[5]||(t[5]=u=>o.value.canonical=u),color:"primary",label:"Cumple con las normas del Derecho Canónico"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(i,{cols:"12",md:"9"},{default:l(()=>[e(J,null,{default:l(()=>t[15]||(t[15]=[$("span",{class:"text-subtitle-2 text-secondary"}," Información de la(s) persona(s) ",-1)])),_:1}),e(E,{"no-gutters":""},{default:l(()=>[e(i,{cols:"12"},{default:l(()=>[e(N,{family:"",modelValue:o.value.roles[0],"onUpdate:modelValue":t[6]||(t[6]=u=>o.value.roles[0]=u),title:"Bautizado"},null,8,["modelValue"])]),_:1}),e(i,{cols:"6"},{default:l(()=>[e(N,{modelValue:o.value.roles[0].family[0],"onUpdate:modelValue":t[7]||(t[7]=u=>o.value.roles[0].family[0]=u),title:"Padre"},null,8,["modelValue"])]),_:1}),e(i,{cols:"6"},{default:l(()=>[e(N,{modelValue:o.value.roles[0].family[1],"onUpdate:modelValue":t[8]||(t[8]=u=>o.value.roles[0].family[1]=u),title:"Madre"},null,8,["modelValue"])]),_:1}),e(i,{cols:"6"},{default:l(()=>[e(N,{modelValue:o.value.roles[1],"onUpdate:modelValue":t[9]||(t[9]=u=>o.value.roles[1]=u),title:"Padrino"},null,8,["modelValue"])]),_:1}),e(i,{cols:"6"},{default:l(()=>[e(N,{modelValue:o.value.roles[2],"onUpdate:modelValue":t[10]||(t[10]=u=>o.value.roles[2]=u),title:"Madrina"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ee,{class:"border-t"},{default:l(()=>[e(n,{type:"button",variant:"text",color:"secondary",onClick:t[11]||(t[11]=u=>v.value=!1)},{default:l(()=>t[16]||(t[16]=[b(" Cancelar ")])),_:1}),e(f),e(n,{text:"Asentar y guardar",color:"primary","prepend-icon":"mdi-file-certificate-outline",variant:"outlined",type:"button",onClick:B,loading:r.value},null,8,["loading"]),e(n,{text:"Guardar",color:"primary",type:"submit",loading:r.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue"])}}}),be={class:"text-h6"},ye={class:"text-subtitle-2"},Ve={class:"text-subtitle-2"},Oe=j({__name:"baptism-participant",setup(U){const y=G(),w=I(null),P=async k=>{const r=y.params.id;return await se(k,Number(r))};return(async()=>{const k=y.params.id;w.value=await re(Number(k))})(),(k,r)=>{const v=a("v-icon"),V=a("v-btn"),d=a("v-card-item"),o=a("v-text-field"),O=a("v-col"),s=a("v-row"),D=a("v-chip"),B=a("v-list-item"),C=a("LnxDialogConfirm"),R=a("v-list"),A=a("v-menu"),c=a("LnxDataTable"),t=a("v-card"),f=H("tooltip"),_=H("permission");return g(),x(t,{title:"Registro de participantes",subtitle:"Gestión de participantes en el sacramento"},{append:l(()=>[S((g(),x(V,{icon:"",density:"compact",variant:"tonal"},{default:l(()=>[e(ie,{type:"1"}),e(v,null,{default:l(()=>r[0]||(r[0]=[b("mdi-tune-variant")])),_:1})]),_:1})),[[f,"Definir Parámetros"]])]),default:l(()=>[e(d,{class:"border-t"},{default:l(()=>{var n,p,i;return[$("p",be,F((n=w.value)==null?void 0:n.dateFormatted),1),$("p",ye,F((p=w.value)==null?void 0:p.parish),1),$("p",Ve,F((i=w.value)==null?void 0:i.minister),1)]}),_:1}),e(c,{loadDataTable:P,headers:K(ue)},{header:l(({request:n,loading:p,init:i,loadingTable:m,debouncedReload:M,reLoadDataTable:T})=>[e(d,{class:"border-t border-b"},{default:l(()=>[e(s,{class:"d-flex justify-space-between align-center"},{default:l(()=>[e(O,{cols:"12",md:"4"},{default:l(()=>[e(o,{modelValue:n.search,"onUpdate:modelValue":E=>n.search=E,label:"Buscar",clearable:"",onInput:M,"onClick:clear":T},null,8,["modelValue","onUpdate:modelValue","onInput","onClick:clear"])]),_:2},1024),e(O,{cols:"12",md:"4",class:"d-md-flex d-block justify-end text-end"},{default:l(()=>[S((g(),x(V,{"prepend-icon":"mdi-plus",class:"me-2",disabled:p},{default:l(()=>[r[1]||(r[1]=b(" acta ")),e(Q,{onOnSuccess:i},null,8,["onOnSuccess"])]),_:2},1032,["disabled"])),[[_,["crear_acta_bautismo"]]]),S((g(),x(V,{"prepend-icon":"mdi-plus",class:"me-2",disabled:p},{default:l(()=>[r[2]||(r[2]=b(" participante ")),e(fe,{onOnSuccess:i},null,8,["onOnSuccess"])]),_:2},1032,["disabled"])),[[_,["agregar_participante_bautismo"]]]),S(e(V,{density:"comfortable",icon:"mdi-reload",onClick:i,loading:m},null,8,["onClick","loading"]),[[f,"Recargar registros"]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.status":l(({item:n})=>[e(D,{color:n.status?"blue":"error",variant:"outlined"},{default:l(()=>[b(F(n.status?"Activo":" Anulado "),1)]),_:2},1032,["color"])]),"item.actions":l(({item:n,loadDataTable:p})=>[S((g(),x(V,{icon:"",size:"small",variant:"text",disabled:!n.status},{default:l(()=>[e(v,null,{default:l(()=>r[3]||(r[3]=[b(" mdi-dots-vertical ")])),_:1}),e(A,{activator:"parent"},{default:l(()=>[e(R,{nav:""},{default:l(()=>[n.status&&n.issueDate===null?S((g(),x(B,{key:0,title:"Editar",density:"compact",value:"edit"},{prepend:l(()=>[e(v,{size:"small"},{default:l(()=>r[4]||(r[4]=[b(" mdi-pencil ")])),_:1})]),default:l(()=>[e(Q,{recordId:n.id,onOnSuccess:p},null,8,["recordId","onOnSuccess"])]),_:2},1024)),[[_,["editar_acta_bautismo"]]]):L("",!0),n.status&&n.issueDate!==null?S((g(),x(B,{key:1,title:"Imprimir Acta",density:"compact",value:"print"},{prepend:l(()=>[e(v,{size:"small"},{default:l(()=>r[5]||(r[5]=[b(" mdi-printer ")])),_:1})]),default:l(()=>[e(_e,{record:n,onOnSuccess:p},null,8,["record","onOnSuccess"])]),_:2},1024)),[[_,["imprimir_acta_bautismo"]]]):L("",!0),n.status&&n.issueDate!==null?S((g(),x(B,{key:2,title:"Anular",class:"text-red",density:"compact",value:"annular"},{prepend:l(()=>[e(v,{size:"small"},{default:l(()=>r[6]||(r[6]=[b(" mdi-minus-circle-outline ")])),_:1})]),default:l(()=>[e(ce,{onOnSuccess:p,record:n},null,8,["onOnSuccess","record"])]),_:2},1024)),[[_,["anular_acta_bautismo"]]]):L("",!0),n.issueDate==null?S((g(),x(B,{key:3,title:"Eliminar",class:"text-red",density:"compact",value:"delete"},{prepend:l(()=>[e(v,{size:"small"},{default:l(()=>r[7]||(r[7]=[b(" mdi-delete ")])),_:1})]),default:l(()=>[e(C,{onOnConfirm:async()=>{await K(ne)(n.id),p()},message:"¿Está seguro de eliminar este registro?"},null,8,["onOnConfirm"])]),_:2},1024)),[[_,["eliminar_acta_bautismo"]]]):L("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["disabled"])),[[_,["editar_acta_bautismo","imprimir_acta_bautismo","anular_acta_bautismo","eliminar_acta_bautismo"]],[f,"Opciones"]])]),_:1},8,["headers"])]),_:1})}}});export{Oe as default};
