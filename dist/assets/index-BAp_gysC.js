import{y as B,z as P,d as U,b as w,r as o,o as $,c as j,w as t,a as e,u as f,g as c,f as L,h as R,i as E,e as V,t as T}from"./index-Cg9yRFqc.js";import{i as F}from"./DataTable.types-CX4v7_jN.js";import{r as I}from"./ruleUtils-Dk9EfJu0.js";const O="https://church-api.linox.net.pe/api/permissions",M=async p=>{try{const r=B();return(await P(r,O).post("/load-data-table",p)).data.data}catch{return F()}},q=async p=>{try{const r=B();return await P(r,O).post("/save",p),!0}catch{return!1}},A=[{title:"Nombre",value:"displayName",key:"permissions.display_name"},{title:"Clave",value:"name",key:"permissions.name"}],H={displayName:[I],type:[I]},J=()=>({id:null,type:"",displayName:null,parentId:null}),D=U({__name:"Form",props:{formState:{type:Object,default:()=>({})}},emits:["onSuccess"],setup(p,{emit:r}){const n=r,S=p,g=H,l=w(null),y=w(!1),u=w(!1),i=w({...J(),...S.formState}),N=async()=>{const{valid:x}=await l.value.validate();if(!x)return;y.value=!0,await q(i.value)&&(i.value.id==null&&l.value.reset(),n("onSuccess"),u.value=!1),y.value=!1};return(x,s)=>{const C=o("v-text-field"),a=o("v-col"),b=o("v-row"),m=o("v-card-item"),_=o("v-btn"),d=o("v-spacer"),v=o("v-card-actions"),h=o("v-card"),z=o("v-form"),G=o("v-dialog");return $(),j(G,{"max-width":"700",modelValue:u.value,"onUpdate:modelValue":s[2]||(s[2]=k=>u.value=k),activator:"parent"},{default:t(()=>[e(z,{ref_key:"formRef",ref:l,onSubmit:L(N,["prevent"])},{default:t(()=>[e(h,{title:i.value.id?"Editar Registro":"Nuevo Registro"},{default:t(()=>[e(m,{class:"border-t border-b"},{default:t(()=>[e(b,null,{default:t(()=>[e(a,{cols:"12"},{default:t(()=>[e(C,{modelValue:i.value.displayName,"onUpdate:modelValue":s[0]||(s[0]=k=>i.value.displayName=k),label:"Nombre",rules:f(g).displayName,autocomplete:"off"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),e(v,null,{default:t(()=>[e(_,{type:"button",variant:"text",color:"secondary",onClick:s[1]||(s[1]=k=>u.value=!1)},{default:t(()=>s[3]||(s[3]=[c(" Cancelar ")])),_:1}),e(d),e(_,{text:"Guardar",color:"primary",type:"submit",loading:y.value},null,8,["loading"])]),_:1})]),_:1},8,["title"])]),_:1},512)]),_:1},8,["modelValue"])}}}),K={class:"bg-gray"},Q=["colspan"],W={class:"d-flex justify-space-between align-center"},X={class:"text-primary"},te=U({__name:"index",setup(p){return(r,n)=>{const S=o("v-text-field"),g=o("v-col"),l=o("v-btn"),y=o("v-row"),u=o("v-card-item"),i=o("v-icon"),N=o("LnxDataTable"),x=o("v-card"),s=R("tooltip"),C=R("permission");return $(),j(x,{title:"Permisos",subtitle:"GestiÃ³n de permisos"},{default:t(()=>[e(N,{loadDataTable:f(M),headers:f(A),groupBy:[{key:"parentName"}]},{header:t(({request:a,loading:b,init:m,loadingTable:_,debouncedReload:d,reLoadDataTable:v})=>[e(u,{class:"border-t border-b"},{default:t(()=>[e(y,{class:"d-flex justify-space-between"},{default:t(()=>[e(g,{cols:"12",md:"4"},{default:t(()=>[e(S,{modelValue:a.search,"onUpdate:modelValue":h=>a.search=h,label:"Buscar",clearable:"",onInput:d,"onClick:clear":v},null,8,["modelValue","onUpdate:modelValue","onInput","onClick:clear"])]),_:2},1024),e(g,{cols:"12",md:"4",class:"d-flex justify-end text-end align-center"},{default:t(()=>[e(l,{class:"me-2",disabled:b},{default:t(()=>[n[0]||(n[0]=c(" Registrar modulo ")),e(f(D),{formState:{type:"001"},onOnSuccess:m},null,8,["onOnSuccess"])]),_:2},1032,["disabled"]),E(e(l,{density:"comfortable",icon:"mdi-reload",onClick:m,loading:_},null,8,["onClick","loading"]),[[s,"Recargar registros","top"],[C,["permission.list"]]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"group-header":t(({item:a,columns:b,toggleGroup:m,isGroupOpen:_})=>[V("tr",K,[V("td",{colspan:b.length,class:"bg-grey-lighten-4"},[V("div",W,[V("div",X,[e(l,{"prepend-icon":_(a)?"$expand":"$next",size:"small",variant:"plain",onClick:d=>m(a)},{default:t(()=>[c(T(a.value),1)]),_:2},1032,["prepend-icon","onClick"])]),e(l,{"prepend-icon":"mdi-plus",density:"compact",variant:"tonal"},{default:t(()=>{var d,v;return[n[1]||(n[1]=c(" Permiso ")),e(f(D),{formState:{type:"002",parentId:(v=(d=a==null?void 0:a.items[0])==null?void 0:d.raw)==null?void 0:v.parentId}},null,8,["formState"])]}),_:2},1024)])],8,Q)])]),"item.actions":t(({item:a})=>[c(T(a.id),1)]),"item.permissions":t(({item:a})=>[e(l,{rounded:"sm",variant:"tonal",class:"me-1",density:"comfortable","prepend-icon":"mdi-eye"},{default:t(()=>n[2]||(n[2]=[c(" Permisos ")])),_:1}),e(l,{rounded:"sm",variant:"tonal",class:"",density:"compact",icon:""},{default:t(()=>[e(i,null,{default:t(()=>n[3]||(n[3]=[c("mdi-plus")])),_:1}),e(f(D),{formState:{parentId:a.id,type:"002"}},null,8,["formState"])]),_:2},1024)]),_:1},8,["loadDataTable","headers"])]),_:1})}}});export{te as default};
