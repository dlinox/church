import{j,k as L,d as q,b as f,r as l,o as N,c as $,w as t,a as e,u as v,l as A,g as w,f as F,p as M,q as P,t as J}from"./index-DEEauFT0.js";import{r as k,e as K}from"./ruleUtils-C0l0TtdP.js";import{i as Q}from"./DataTable.types-CX4v7_jN.js";import{_ as W}from"./selectItems.services-CJ7_Aave.js";const C={name:[k],email:[k,K],username:[k],password:[],status:[k],role:[k]},G=()=>({id:null,name:null,email:"",password:null,username:"",role:null,status:!0}),z="http://lnx.simple.auth.test/api/users",X=async i=>{try{const s=j();return(await L(s,z).post("/load-data-table",i)).data.data}catch{return Q()}},Y=async i=>{try{const s=j();return await L(s,z).post("/save",i),!0}catch(s){return(s==null?void 0:s.status)==422?s.response.data:!1}},Z=async i=>{try{const s=j();return await L(s,z).delete(`/delete/${i}`),!0}catch{return!1}},H=q({__name:"Form",props:{formState:{type:Object,default:()=>({})},roleItems:{type:Array,default:()=>[]}},emits:["onSuccess"],setup(i,{emit:s}){const U=s,B=i,r=f(null),b=f(!1),p=f(!1),d=f(!1),o=f({...G(),...B.formState}),m=f({}),V=async()=>{if(b.value)return;m.value={};const{valid:g}=await r.value.validate();if(!g)return;b.value=!0;const a=await Y(o.value);a&&(a.errors?m.value=a.errors:(o.value.id==null&&(o.value=G()),U("onSuccess"),p.value=!1)),b.value=!1};return(g,a)=>{const y=l("v-text-field"),c=l("v-col"),I=l("v-select"),S=l("v-switch"),D=l("v-row"),u=l("v-card-item"),_=l("v-btn"),x=l("v-spacer"),R=l("v-card-actions"),O=l("v-card"),T=l("v-form"),E=l("v-dialog");return N(),$(E,{"max-width":"500",modelValue:p.value,"onUpdate:modelValue":a[8]||(a[8]=n=>p.value=n),activator:"parent"},{default:t(()=>[e(T,{ref_key:"formRef",ref:r,onSubmit:F(V,["prevent"])},{default:t(()=>[e(O,{title:o.value.id?"Editar Registro":"Nuevo Registro"},{default:t(()=>[e(u,{class:"border-t border-b"},{default:t(()=>[e(D,null,{default:t(()=>[e(c,{cols:"12"},{default:t(()=>[e(y,{modelValue:o.value.name,"onUpdate:modelValue":a[0]||(a[0]=n=>o.value.name=n),label:"Nombre completo",rules:v(C).name,autocomplete:"off","error-messages":m.value.name},null,8,["modelValue","rules","error-messages"])]),_:1}),e(c,{cols:"12"},{default:t(()=>[e(y,{modelValue:o.value.email,"onUpdate:modelValue":a[1]||(a[1]=n=>o.value.email=n),label:"Correo electrónico",rules:v(C).email,autocomplete:"off","error-messages":m.value.email},null,8,["modelValue","rules","error-messages"])]),_:1}),e(c,{cols:"12"},{default:t(()=>[e(y,{modelValue:o.value.username,"onUpdate:modelValue":a[2]||(a[2]=n=>o.value.username=n),label:"Usuario",rules:v(C).username,autocomplete:"off","error-messages":m.value.username},null,8,["modelValue","rules","error-messages"])]),_:1}),o.value.id?A("",!0):(N(),$(c,{key:0,cols:"12"},{default:t(()=>[e(y,{modelValue:o.value.password,"onUpdate:modelValue":a[3]||(a[3]=n=>o.value.password=n),label:"Contraseña",rules:v(C).password,type:d.value?"text":"password",autocomplete:"new-password","append-inner-icon":d.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":a[4]||(a[4]=n=>d.value=!d.value),"error-messages":m.value.password},null,8,["modelValue","rules","type","append-inner-icon","error-messages"])]),_:1})),e(c,{cols:"12"},{default:t(()=>[e(I,{modelValue:o.value.role,"onUpdate:modelValue":a[5]||(a[5]=n=>o.value.role=n),items:i.roleItems,label:"Rol",autocomplete:"off",rules:v(C).role,"error-messages":m.value.role},null,8,["modelValue","items","rules","error-messages"])]),_:1}),e(c,{cols:"12"},{default:t(()=>[e(S,{label:o.value.status?"Habilitado":"Deshabilitado",modelValue:o.value.status,"onUpdate:modelValue":a[6]||(a[6]=n=>o.value.status=n),color:"blue-darken-4",inset:""},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1}),e(R,null,{default:t(()=>[e(_,{type:"button",variant:"text",color:"secondary",onClick:a[7]||(a[7]=n=>p.value=!1)},{default:t(()=>a[9]||(a[9]=[w(" Cancelar ")])),_:1}),e(x),e(_,{text:"Guardar",color:"primary",type:"submit",loading:b.value},null,8,["loading"])]),_:1})]),_:1},8,["title"])]),_:1},512)]),_:1},8,["modelValue"])}}}),h=[{title:"Op.",key:"actions",value:"actions",fixed:!0,width:"50px",sortable:!1},{title:"Nombre",key:"name",value:"name"},{title:"Correo",key:"email",value:"email"},{title:"Usuario",key:"username",value:"username"},{title:"Rol",key:"role",value:"role.title"},{title:"Estado",key:"status",value:"status"}],oe=q({__name:"index",setup(i){const s=f([]);return(async()=>{s.value=await W()})(),(B,r)=>{const b=l("v-text-field"),p=l("v-col"),d=l("v-btn"),o=l("v-row"),m=l("v-card-item"),V=l("v-icon"),g=l("v-list-item"),a=l("LnxDialogConfirm"),y=l("v-list"),c=l("v-menu"),I=l("LnxDataTable"),S=l("v-card"),D=M("tooltip");return N(),$(S,{title:"Usuarios",subtitle:"Gestión de usuarios"},{default:t(()=>[e(I,{loadDataTable:v(X),headers:v(h)},{header:t(({request:u,loading:_,init:x,loadingTable:R,debouncedReload:O,reLoadDataTable:T})=>[e(m,{class:"border-t border-b"},{default:t(()=>[e(o,{class:"d-flex justify-space-between"},{default:t(()=>[e(p,{cols:"12",md:"4"},{default:t(()=>[e(b,{modelValue:u.search,"onUpdate:modelValue":E=>u.search=E,label:"Buscar",clearable:"",onInput:O,"onClick:clear":T},null,8,["modelValue","onUpdate:modelValue","onInput","onClick:clear"])]),_:2},1024),e(p,{cols:"12",md:"4",class:"d-flex justify-end"},{default:t(()=>[e(d,{class:"me-1",disabled:_},{default:t(()=>[e(H,{roleItems:s.value,onOnSuccess:x},null,8,["roleItems","onOnSuccess"]),r[0]||(r[0]=w(" nuevo "))]),_:2},1032,["disabled"]),P(e(d,{density:"comfortable",icon:"mdi-reload",onClick:x,loading:R},null,8,["onClick","loading"]),[[D,"Recargar registros"]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.actions":t(({item:u,loadDataTable:_})=>[e(d,{icon:"",size:"small",variant:"text"},{default:t(()=>[e(V,null,{default:t(()=>r[1]||(r[1]=[w(" mdi-dots-vertical ")])),_:1}),e(c,{activator:"parent"},{default:t(()=>[e(y,{nav:""},{default:t(()=>[e(g,{title:"Editar",density:"compact",value:"edit"},{prepend:t(()=>[e(V,{size:"small"},{default:t(()=>r[2]||(r[2]=[w(" mdi-pencil ")])),_:1})]),default:t(()=>[e(H,{roleItems:s.value,formState:u,onOnSuccess:x=>_()},null,8,["roleItems","formState","onOnSuccess"])]),_:2},1024),e(g,{title:"Eliminar",class:"text-red",density:"compact",value:"delete"},{prepend:t(()=>[e(V,{size:"small"},{default:t(()=>r[3]||(r[3]=[w(" mdi-delete ")])),_:1})]),default:t(()=>[e(a,{onOnConfirm:async()=>{await v(Z)(u.id),_()},message:"¿Está seguro de eliminar este registro?"},null,8,["onOnConfirm"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.status":t(({item:u})=>[e(d,{color:u.status?"blue":"error",density:"compact",variant:"tonal"},{default:t(()=>[w(J(u.status?"Habilitado":"Deshabilitado"),1)]),_:2},1032,["color"])]),_:1},8,["loadDataTable","headers"])]),_:1})}}});export{oe as default};
